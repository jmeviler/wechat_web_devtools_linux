"use strict";function init(){function e(e,n){return"\n      <script>"+d[e.hash]+'</script>\n      <script>\n        document.dispatchEvent(new CustomEvent("generateFuncReady", {\n          detail: {\n            generateFunc: $gwx(\'./'+n+"')\n          }\n        }))\n      </script>\n    "}var n=global.appConfig.isDev,t="darwin"===process.platform,r=(require("fs"),require("path")),i=require("../../config/dirConfig.js"),o=i.WeappVendor,s=require("../utils/tools.js"),c=require("../utils/projectManager.js"),a=n?r.join(__dirname,"../vendor/"):o,u=t?r.join(a,"wcc"):r.join(a,"wcc.exe"),l=(require("glob"),require("child_process").spawn),p=require("../../config/config.js"),g=p.WXML_ERROR,f=p.WXML_LOSE_ERROR,d={};c.manager.on("FILE_CHANGE",function(e,n,t){".wxml"===r.extname(t)&&delete d[e.hash]}),_exports=function(n,t,i){var o=t.project,a=s.getFilePath(n,o),p=r.relative(o.projectpath,a),h="",m="";return d[o.hash]?void process.nextTick(function(){i(null,{generateFunc:e(o,p.replace(/\\/g,"/")),styleStr:h})}):void c.getAllWXMLFileList(o,function(n,t){for(var r=c.getAppJSONSync(o),s=r.pages,a=0,v=s.length;a<v;a++){var x="./"+s[a]+".wxml",w=t.indexOf(x);if(w===-1)return void i({type:f,msgForConsole:a+":"+JSON.stringify(r),msg:"编译 .wxml 文件错误， 错误信息：未找到页面 "+s[a]+" 对应的 wxml 文件"})}if(n)i(n.toString());else{var j=["-d"].concat(t),_=l(u,j,{cwd:o.projectpath}),F=[],S=[];_.on("close",function(n){if(0===n)d[o.hash]=Buffer.concat(F).toString(),m=e(o,p.replace(/\\/g,"/")),i(null,{generateFunc:m,styleStr:h});else{var t=Buffer.concat(S).toString();i({type:g,msgForConsole:t,msg:"编译 .wxml 文件错误， 错误信息："+t+"，可在控制台查看更详细信息"})}}),_.stdout.on("data",function(e){F.push(e)}),_.stderr.on("data",function(e){S.push(e)})}})}}var _exports;init(),module.exports=_exports;