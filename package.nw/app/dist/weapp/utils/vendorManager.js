"use strict";function init(){function e(){s.info("vendorManager.js begin init");for(var e in m)if(x[e]){var n=g?e:e+".exe",i=c.join(w,n),o=c.join(j,n),t=f.readFileSync(i);f.writeFileSync(o,t,{mode:511})}else{var a=c.join(w,e),l=c.join(j,e),u=f.readFileSync(a);F[e]=u,f.writeFileSync(l,u)}m.appVersion=q;var d=JSON.stringify(m);f.writeFileSync(v,d),r=m,s.info("vendorManager.js end init with config "+d)}function n(e){O.forEach(function(n){var o=r[n],l=e[n];if(o<l){var u={url:p+"&type="+n.replace(".js",""),needToken:0,encoding:null};s.info("vendorManager.js begin get new "+n+": "+u.url),t(u,function(e,o,t){if(e)s.error("vendorManager.js end error "+JSON.stringify(e));else{try{if(x[n]){var u=g?c.join(j,n):c.join(j,n+".exe");f.writeFileSync(u,t,{mode:511}),r[n]=l,f.writeFileSync(v,JSON.stringify(r),"utf8")}else F[n]=t.toString(),N.vendorChange(n,F[n]),f.writeFileSync(c.join(j,n),t),r[n]=l,f.writeFileSync(v,JSON.stringify(r),"utf8");clearTimeout(i),h.push(n),i=setTimeout(function(){a.notifications({title:"基础组件库更新啦",message:"这次更新的是 \n "+h.join(","),buttons:[{title:"查看更新日志"}]},function(e){0===e&&nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html")}),h=[]},5e3)}catch(e){s.error("vendorManager.js end catch "+JSON.stringify(e))}s.info("vendorManager.js end up "+n)}})}})}var i,r,o=global.appConfig.isDev,t=require("request"),s=(require("glob"),require("crypto"),require("../../common/log/log.js")),a=(require("../../utils/tools.js"),require("../../utils/notifyManager.js")),c=(require("mkdir-p"),require("path")),f=require("fs"),l=require("events").EventEmitter,u=require("../../config/urlConfig.js"),d=require("../../config/dirConfig.js"),g="darwin"===process.platform,p=u.downloadRedirectURL+(g?"?os=darwin":"?os=win"),j=d.WeappVendor,v=c.join(j,"version.json"),w=o?c.join(__dirname,"../vendor/"):c.join(__dirname,"../onlinevendor/"),y=o?c.join(w,"config.json"):c.join(w,"version.json"),S=f.readFileSync(y,"utf8"),m=JSON.parse(S),q=global.appVersion,h=[],F={},x={wcc:!0,wcsc:!0,"wcc.exe":!0,"wcsc.exe":!0};if(!o)try{if(r=JSON.parse(f.readFileSync(v,"utf8")),r.appVersion!==q)s.info("vendorManager.js get appVersion is "+r.appVersion+" , currentAppversion is "+q),e();else for(var b in r)if(!x[b]&&"appVersion"!==b){var M=c.join(j,b);F[b]=f.readFileSync(M,"utf8")}}catch(n){s.error("vendorManager.js "+n.toString()),e()}var N=Object.assign({},l.prototype,{vendorChange:function(e,n){this.emit("VENDOR_CHANGE",e,n)}}),O=["WAService.js","WAWebview.js","wcc","wcsc"];_exports={check:function(e){o||n(e)},getFile:function(e){return o?f.readFileSync(c.join(w,e),"utf8"):F[e]},manager:N}}var _exports;init(),module.exports=_exports;