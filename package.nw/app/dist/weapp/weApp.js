"use strict";function _defineProperty(e,r,s){return r in e?Object.defineProperty(e,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[r]=s,e}function init(){var e=global.appConfig.isDev,r=require("../config/config.js"),s=r.JSON_PARSE_ERROR,i=r.ES6_ERROR,t=r.JSON_FILE_ERROR,n=r.JSON_ENTRANCE_ERROR,p=r.JSON_CONTENT_ERROR,a=require("./trans/transManager.js"),o=require("./utils/tools.js"),c=(require("async"),require("fs")),l=require("path"),u=require("url"),f=require("querystring"),g=require("./utils/vendorManager.js"),j=(require("glob"),require("./utils/projectManager.js")),h=require("../config/appserviceConfig.js"),v=require("../stores/projectStores.js"),d=require("../stores/windowStores.js"),_=require("../actions/windowActions.js"),q=require("./utils/parseErr.js"),R=require("../utils/file.js"),w=require("../config/sceneConfig.js"),E=w.defaultScene,m=(require("./tpl/errorTpl.js"),require("./tpl/appserviceErrorTpl.js"),l.join(__dirname,"appservice/asdebug.js")),S=c.readFileSync(m,"utf8");o.noBrowser.join(",");_exports.getAppservice=function(r,a){var R=o.getProject(r),w=u.parse(r),m=w.pathname,P=/appservice$/.test(m),C=/appservice-sdk\.js$/.test(m),y=/asdebug\.js$/.test(m),x=/ascheck\.js$/.test(m),F=/webnode\.js$/.test(m),O=/reporter-sdk\.js/.test(m),b=/app_service_engine\.js/.test(m),J=(/\.js$/.test(m),/\.js\.map$/.test(m)),N=/WAService\.js/.test(m),T=/favicon\.ico$/.test(m),k=/hls\.js/.test(m),A=/webview-engine\.js/.test(m);if(T)a(200,{},"");else if(N)a(null,{},g.getFile("WAService.js"));else if(O)a(null,{},g.getFile("reporter-sdk.js"));else if(b)a(null,{},g.getFile("app_service_engine.js"));else if(C)a(null,{},g.getFile("appservice-sdk.js"));else if(k)a(null,{},g.getFile("hls.js"));else if(A)a(null,{},g.getFile("webview-engine.js"));else if(y)a(null,{},S);else if(x)a(null,{},asCheck);else if(F)a(null,{},g.getFile("webnode.js"));else if(J){var I=l.join(R.projectpath,m);c.readFile(I,function(e,r){return e?void a(404,{},"do not find "+I):void a(200,{},r)})}else{var $=(R.appname.toLowerCase(),R.appid.toLowerCase(),R.hash),D=void 0;try{D=j.getAppConfigJSONSync(R)}catch(e){return a(200,{},""),void setTimeout(function(){var r=e.type,i=void 0;r===s?i=q.parseJsonParseErr(e):r===t?i=q.parseJsonFileErr(e):r===n?i=q.parseJsonEntranceErr(e):r===p&&(i=q.parseJsonContentErr(e)),_.showWeappError(e.type,i)},200)}var L=v.getProjectConfig(R);D.projectConfig=L,D.appserviceConfig=h;var W=D.pages||[];if(P){var B=require("./tpl/appserviceTpl.js"),U="http://"+$+".appservice.open.weixin.qq.com/",M=[],z=[],G=[];j.getAllJSFileList(R,function(r,s){for(var i={},t=0,n=W.length;t<n;t++){var p=W[t]+".js";i[p]=!0,M.push("<script>__wxRoute = '"+W[t]+"';__wxRouteBegin = true</script>"),M.push('<script src="'+U+p+'"></script>'),M.push('<script>\n              if(__wxRouteBegin) {\n                console.group("'+new Date+' page 编译错误")\n                console.error(` '+W[t]+" 出现脚本错误或者未正确调用 Page()`)\n                console.groupEnd()\n              }\n              </script>")}for(var o=0,c=s.length;o<c;o++){var l=s[o];i[l]||("app.js"===l?G.push('<script src="'+U+l+'"></script>'):z.push('<script src="'+U+l+'"></script>'))}M=z.concat(G).concat(M),e?(M.unshift('<script src="'+U+'app_service_engine.js"></script>'),M.unshift('<script src="'+U+'appservice-sdk.js"></script>'),M.unshift('<script src="'+U+'reporter-sdk.js"></script>'),M.unshift('<script src="'+U+'webnode.js"></script>')):M.unshift('<script src="'+U+'WAService.js"></script>'),M.unshift('<script src="'+U+'asdebug.js"></script>'),D.appname=R.appname,D.app_nickname=R.app_nickname||R.appname,D.appid=R.appid,D.apphash=R.hash,D.isTourist=R.isTourist,D.platform="devtools",R.isTourist&&(D.userInfo=d.getUserInfo()),D.urlCheck=R.urlCheck;var u=D.entryPagePath.replace(/\.html$/,""),g={},j=E,h={};if(R.initPath.enable){u=R.initPath.page||u,g=f.parse(R.initPath.query||""),j=R.initPath.scene||E,R.initPath.appid&&(h.appId=R.initPath.appid);var v={};if(R.initPath.referData){try{v=JSON.parse(R.initPath.referData)}catch(e){M.push('<script>\n                  if(__wxRouteBegin) {\n                    console.group("'+new Date+' referrerInfo.data 编译错误")\n                    console.error(` 请确认编译条件中的启动数据设置是否正确`)\n                    console.groupEnd()\n                  }\n                  </script>'),v={}}h.extraData=v}}D.appLaunchInfo={referrerInfo:h,path:u,scene:j,query:g},M.unshift("<script>var __wxConfig = "+JSON.stringify(D)+"</script>"),B=B.replace("<script></script>",M.join("")),a(null,{},B)})}else{var H=r.replace("http://"+$+".appservice.open.weixin.qq.com/","");j.getScripts({project:R,fileName:H,needRequire:"app.js"===H||W.indexOf(H.replace(/\.js/,""))!==-1},function(e,r){if(e)if(r){var s={file:e.sourceFileName,msg:e.msg};a(null,_defineProperty({},i,encodeURIComponent(JSON.stringify(s))),r)}else e.project=R,_.showWeappError(e.type,q.parseJsFileErr(e)),a(200,{},"");else a(null,{"Content-Type":"text/javascript; charset=UTF-8"},r)})}}},_exports.getLocalIdResponse=function(e,r){if(R.isAppTmpPath(e)){var s=R.getRealPath(e);c.readFile(s,function(e,s){e?r(404,{"Weapp-Error":encodeURIComponent(e)},e.toString()):r(null,{},s)})}else r(404,{},"do not find "+e)},_exports.getResponse=function(e,r){a.getResponse(e,r)}}var _exports={};init(),module.exports=_exports;