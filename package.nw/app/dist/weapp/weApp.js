"use strict";function init(){var e=global.appConfig.isDev,r=require("../config/config.js"),s=r.JSON_PARSE_ERROR,i=r.ES6_ERROR,t=r.JSON_FILE_ERROR,p=r.JSON_ENTRANCE_ERROR,n=r.JSON_CONTENT_ERROR,a=require("./trans/transManager.js"),o=require("./utils/tools.js"),c=(require("async"),require("fs")),u=require("path"),l=require("url"),f=require("querystring"),g=require("./utils/vendorManager.js"),h=(require("glob"),require("./utils/projectManager.js")),j=require("../config/appserviceConfig.js"),v=require("../stores/projectStores.js"),d=require("../stores/windowStores.js"),_=require("../actions/windowActions.js"),q=require("./utils/parseErr.js"),R=require("../utils/file.js"),E=require("../config/weappConfig.js"),m=E.default_scene,w=(require("./tpl/errorTpl.js"),require("./tpl/appserviceErrorTpl.js"),u.join(__dirname,"appservice/asdebug.js")),S=c.readFileSync(w,"utf8");o.noBrowser.join(",");_exports.getAppservice=function(r,a){var R=o.getProject(r),E=l.parse(r),w=E.pathname,C=/appservice$/.test(w),P=/appservice-sdk\.js$/.test(w),x=/asdebug\.js$/.test(w),y=/ascheck\.js$/.test(w),N=/webnode\.js$/.test(w),F=/reporter-sdk\.js/.test(w),O=/app_service_engine\.js/.test(w),J=(/\.js$/.test(w),/\.js\.map$/.test(w)),T=/WAService\.js/.test(w),k=/favicon\.ico$/.test(w);if(k)a(200,{},"");else if(T)a(null,{},g.getFile("WAService.js",R.libVersion));else if(F)a(null,{},g.getFile("reporter-sdk.js"));else if(O)a(null,{},g.getFile("app_service_engine.js"));else if(P)a(null,{},g.getFile("appservice-sdk.js"));else if(x)a(null,{},S);else if(y)a(null,{},asCheck);else if(N)a(null,{},g.getFile("webnode.js"));else if(J){var I=u.join(R.projectpath,w);c.readFile(I,function(e,r){return e?void a(404,{},"do not find "+I):void a(200,{},r)})}else{var b=(R.appname.toLowerCase(),R.appid.toLowerCase(),R.hash),A=void 0;try{A=h.getAppConfigJSONSync(R)}catch(e){return a(200,{},""),void setTimeout(function(){var r=e.type,i=void 0;r===s?i=q.parseJsonParseErr(e):r===t?i=q.parseJsonFileErr(e):r===p?i=q.parseJsonEntranceErr(e):r===n&&(i=q.parseJsonContentErr(e)),_.showWeappError(e.type,i)},200)}var $=v.getProjectConfig(R);A.projectConfig=$,A.appserviceConfig=j;var W=A.pages||[];if(C){var D=require("./tpl/appserviceTpl.js"),L="http://"+b+".appservice.open.weixin.qq.com/",B=[],M=[],U=[];h.getAllJSFileList(R,function(r,s){for(var i={},t=0,p=W.length;t<p;t++){var n=W[t]+".js";i[n]=!0,B.push("<script>__wxRoute = '"+W[t]+"';__wxRouteBegin = true</script>"),B.push('<script src="'+L+n+'"></script>'),B.push('<script>\n              if(__wxRouteBegin) {\n                console.group("'+new Date+' page 编译错误")\n                console.error(` '+W[t]+" 出现脚本错误或者未正确调用 Page()`)\n                console.groupEnd()\n              }\n              </script>")}for(var o=0,c=s.length;o<c;o++){var u=s[o];i[u]||("app.js"===u?U.push('<script src="'+L+u+'"></script>'):M.push('<script src="'+L+u+'"></script>'))}B=M.concat(U).concat(B),e?(B.unshift('<script src="'+L+'app_service_engine.js"></script>'),B.unshift('<script src="'+L+'appservice-sdk.js"></script>'),B.unshift('<script src="'+L+'reporter-sdk.js"></script>'),B.unshift('<script src="'+L+'webnode.js"></script>')):B.unshift('<script src="'+L+'WAService.js"></script>'),B.unshift('<script src="'+L+'asdebug.js"></script>'),A.appname=R.appname,A.app_nickname=R.app_nickname||R.appname,A.appid=R.appid,A.apphash=R.hash,A.isTourist=R.isTourist,A.platform="devtools",R.isTourist&&(A.userInfo=d.getUserInfo()),A.urlCheck=R.urlCheck;var l,g,h=A.entryPagePath.replace(/\.html$/,""),j={},v=m;if(R.initPath.enable){h=R.initPath.page||h,j=f.parse(R.initPath.query||""),v=R.initPath.scene||m,R.initPath.appid&&(l.appId=R.initPath.appid);var _={};if(R.initPath.referData){try{_=JSON.parse(R.initPath.referData)}catch(e){B.push('<script>\n                  if(__wxRouteBegin) {\n                    console.group("'+new Date+' referrerInfo.data 编译错误")\n                    console.error(` 请确认编译条件中的启动数据设置是否正确`)\n                    console.groupEnd()\n                  }\n                  </script>'),_={}}l.extraData=_}g={};var q=R.initPath.groupInfo;q&&(g.shareKey=q.shareKey||"",g.shareName=q.shareName||"")}A.appLaunchInfo={referrerInfo:l,shareInfo:g,path:h,scene:parseInt(v),query:j},B.unshift("<script>var __wxConfig = "+JSON.stringify(A)+"</script>"),D=D.replace("<script></script>",B.join("")),a(null,{},D)})}else{var K=r.replace("http://"+b+".appservice.open.weixin.qq.com/","");h.getScripts({project:R,fileName:K,needRequire:"app.js"===K||W.indexOf(K.replace(/\.js/,""))!==-1},function(e,r){e?r?(_.showWeappError(i,{file:e.sourceFileName,msg:e.msg}),a(200,{},"")):(e.project=R,_.showWeappError(e.type,q.parseJsFileErr(e)),a(200,{},"")):a(null,{"Content-Type":"text/javascript; charset=UTF-8"},r)})}}},_exports.getLocalIdResponse=function(e,r){if(R.isAppTmpPath(e)){var s=R.getRealPath(e);c.readFile(s,function(e,s){e?r(404,{"Weapp-Error":encodeURIComponent(e)},e.toString()):r(null,{},s)})}else r(404,{},"do not find "+e)},_exports.getResponse=function(e,r){a.getResponse(e,r)}}var _exports={};init(),module.exports=_exports;