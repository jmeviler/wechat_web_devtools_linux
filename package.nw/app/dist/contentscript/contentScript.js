"use strict";function postMessageToNW(e){if(e.webviewID=webviewID,e.weappID=weappID,!portInit)return void portMsgQuery.push(e);for(__msgQueue[e.__id]=e;__msgQueue[__id];)port.postMessage(__msgQueue[__id]),delete __msgQueue[__id],__id++}function postMessageToWebPage(e){return postMessageInit?(e.webviewID=webviewID,void window.postMessage(e,"*")):void postMessageQuery.push(e)}function handleMsg(e){var o=e.command;if("SHAKE_HANDS"===o)portInit=!0,portMsgQuery.length&&(portMsgQuery.forEach(function(e){postMessageToNW(e)}),portMsgQuery=[]);else if("ERR_CONNECTION_RESET"!==o||showProxyErr){if("SHOW_SYS_INFO"===o){var t=e.msg,s=t.memory,r=t.restartInfo,n=+new Date-r.projectBeginTime,a=r.projectRestartNum;console.group(new Date+" 工具系统信息"),console.info("工具已运行 "+(n/1e3).toFixed(2)+" 秒，执行编译 "+a+" 次， 当前内存占用 "+s.toFixed(2)+"m"),console.table(t.info),console.groupEnd()}}else{var i=e.msg,p="因为网络代理软件或者 VPN 影响，工具无法加载本地模拟开发服务 "+i.url+" 请尝试以下任一解决方案\n1.关闭相关网络代理软件，重新编译成功后，再启动相关网络代理软件；\n2.配置相关软件不针对 *.appservice.open.weixin.qq.com 和 *.debug.open.weixin.qq.com 进行代理；\n3.配置相关软件不针对 开发者工具 做代理。";console.group(new Date+" 工具加载错误"),console.error(p),console.groupEnd(),showProxyErr=!0}}function receiveMessageFromPageFrame(e){"backgroundjs"===e.to&&postMessageToNW(e)}var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},ua=navigator.userAgent,webviewID=parseInt(ua.match(/webview\/(\d*)/)[1]),weapp=ua.match(/weapp\/(\d*)/),weappID=weapp?parseInt(weapp[1]):void 0;window.runtime={};var portInit=!1,postMessageInit=!1,portMsgQuery=[],postMessageQuery=[],port=window.runtime.port=chrome.runtime.connect("",{name:"webview"+webviewID}),__msgQueue={},__id=0,showProxyErr=!1;port.onMessage.addListener(function(e){var o=e.to;"contentscript"===o?handleMsg(e):"webframe"===o?postMessageToWebPage(e):"appservice"===o&&postMessageToWebPage(e)}),window.addEventListener("message",function(e){var o=e.data;if(o&&"object"===("undefined"==typeof o?"undefined":_typeof(o))&&o.webviewID===webviewID){var t=o.comefrom,s=o.to;if("webframe"===t){var r=o.command;"contentscript"===s&&"SHAKE_HANDS"===r?(postMessageInit=!0,postMessageQuery.length&&(postMessageQuery.forEach(function(e){postMessageToWebPage(e)}),postMessageQuery=[])):receiveMessageFromPageFrame(o)}}});