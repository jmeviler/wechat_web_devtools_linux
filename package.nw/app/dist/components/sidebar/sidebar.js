"use strict";function init(){var e,t=require("../../lib/react.js"),a=require("../../cssStr/cssStr.js"),i=require("../../actions/webviewActions.js"),r=require("../../actions/windowActions.js"),s=require("../../stores/windowStores.js"),n=require("../../actions/projectActions.js"),o=require("../../stores/projectStores.js"),c=(require("../../weapp/utils/projectManager.js"),require("../../config/weappConfig.js")),l=c.default_scene,d=require("./music.js"),p=require("./cache.js"),m=require("./backgroundAudio.js"),u=require("url"),b=require("querystring"),E=require("../../utils/newReport.js"),h=t.createClass({displayName:"Sidebar",getInitialState:function(){return this.props.project&&E("project_debug",this.props.project.appid),{inForeground:!0}},_restart:function(){this.setState({inForeground:!0})},_appEnterBackground:function(){this.setState({inForeground:!1})},_appEnterForeground:function(){this.setState({inForeground:!0})},componentDidMount:function(){o.on("RESTART_PROJECT",this._restart),s.on("APP_ENTER_BACKGROUND",this._appEnterBackground),s.on("APP_ENTER_FOREGROUND",this._appEnterForeground)},componentWillUnmount:function(){o.removeListener("RESTART_PROJECT",this._restart),s.removeListener("APP_ENTER_BACKGROUND",this._appEnterBackground),s.removeListener("APP_ENTER_FOREGROUND",this._appEnterForeground)},handleOnclick:function(e){var t=e.currentTarget,a=t.dataset,i=a.type;this.props.optProject(i),E("project_"+i,this.props.project.appid)},handleAppTerminate:function(e){n.close(),E("project_"+close,this.props.project.appid)},handleAppRestart:function(t){var a=this;clearTimeout(e),e=setTimeout(function(){n.restart(a.props.project);"edit"===a.props.show?"project_compile":"project_restart"},200)},handleAppEnterBackground:function(e){r.appEnterBackground(),i.postMessageToAS({eventName:"onAppRunningStatusChange",data:{status:"background"}}),i.postMessageToAS({eventName:"onAppEnterBackground",type:"ON_APPLIFECYCLE_EVENT"}),E("project_background",this.props.project.appid)},handleAppEnterForeground:function(e){var t=o.getCurrentProject(),a=t.initPath.enable&&t.initPath.scene||l;a=parseInt(a);var n="";r.appEnterForeground({scene:a});try{var c=s.getCurrentWebviewUrl(),d=u.parse(c);n=d.pathname.replace(/^\//,"")}catch(e){}i.postMessageToAS({eventName:"onAppRunningStatusChange",data:{status:"active"}}),i.postMessageToAS({eventName:"onAppEnterForeground",data:{scene:a,path:n||"",query:b.parse(d.query||"")},type:"ON_APPLIFECYCLE_EVENT"})},showCustom:function(){var e=this,t=this.props.project;r.showCustomPreview({project:t,callback:function(a){o.setProjectInitPath(t.hash,{enable:a.enable,page:a.page,scene:a.scene,query:a.query,referData:a.referData,groupInfo:a.groupInfo,appid:a.appid}),e.handleAppRestart()}})},render:function(){var e={detail:"sidebar-item",debug:"sidebar-item",edit:"sidebar-item",mobile:"sidebar-item"},i=this.props.show;if(e[i]="sidebar-item sidebar-item-active",!this.props.project)return t.createElement("div",{className:"sidebar"},t.createElement("div",{"data-type":"debug",onClick:this.handleOnclick,className:e.debug},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-debug"}),t.createElement("label",{className:"sidebar-item-label"},"调试")),t.createElement("div",{className:"sidebar-item sidebar-item-sep"}),t.createElement("div",{className:"sidebar-item-toolbar"},t.createElement("div",{title:"返回","data-type":"appTerminate",onClick:this.handleAppTerminate,className:"sidebar-item"},t.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-close"}),t.createElement("label",{className:"sidebar-item-label"},"返回"))));var r=this.state.inForeground?{}:a.displayNone,s=this.state.inForeground?a.displayNone:{},n="debug"===i||"edit"===i?{}:a.displayNone,o="debug"===i||"edit"===i?{borderTop:"none"}:{};return t.createElement("div",{className:"sidebar"},t.createElement("div",{"data-type":"edit",onClick:this.handleOnclick,className:e.edit},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-editor"}),t.createElement("label",{className:"sidebar-item-label"},"编辑")),t.createElement("div",{"data-type":"debug",onClick:this.handleOnclick,className:e.debug},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-debug"}),t.createElement("label",{className:"sidebar-item-label"},"调试")),t.createElement("div",{"data-type":"detail",onClick:this.handleOnclick,className:e.detail},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-detail"}),t.createElement("label",{className:"sidebar-item-label"},"项目")),t.createElement("div",{className:"sidebar-item sidebar-item-sep"}),t.createElement("div",{className:"sidebar-item-toolbar",style:n},t.createElement(d,null),t.createElement(m,null),t.createElement("div",{title:("darwin"===process.platform?"Command":"Ctrl")+" + b",onClick:this.handleAppRestart,className:"sidebar-item",style:{paddingBottom:0}},t.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-reset"})),t.createElement("div",{title:("darwin"===process.platform?"Command":"Ctrl")+" + b",onClick:this.showCustom,className:"sidebar-item",style:{paddingTop:0,paddingBottom:5}},t.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-custom",style:{marginRight:5}})),t.createElement("div",{onClick:this.handleAppRestart,className:"sidebar-item",style:{paddingTop:0,cursor:"default"}},t.createElement("label",{className:"sidebar-item-label",style:{cursor:"default"}},"编译")),t.createElement("div",{title:"切换到后台","data-type":"appEnterBackground",onClick:this.handleAppEnterBackground,style:r,className:"sidebar-item"},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-backward"}),t.createElement("label",{className:"sidebar-item-label"},"后台")),t.createElement("div",{title:"切换到前台","data-type":"appEnterForeground",onClick:this.handleAppEnterForeground,style:s,className:"sidebar-item"},t.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-forward"}),t.createElement("label",{className:"sidebar-item-label"},"前台")),t.createElement(p,{project:this.props.project})),t.createElement("div",{className:"sidebar-item-toolbar",style:o},t.createElement("div",{title:"关闭项目","data-type":"appTerminate",onClick:this.handleAppTerminate,className:"sidebar-item"},t.createElement("i",{className:"sidebar-item-icon  sidebar-item-icon-close"}),t.createElement("label",{className:"sidebar-item-label"},"关闭"))))}});_exports=h}var _exports;init(),module.exports=_exports;