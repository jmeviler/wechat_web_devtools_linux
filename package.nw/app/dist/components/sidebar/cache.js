"use strict";function init(){function e(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"alert";a.showConfirm({content:e,type:r})}function r(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success";a.showTipsMsg({msg:e,type:r})}var t=require("../../lib/react.js"),i=require("../../cssStr/cssStr.js"),s=require("../../stores/windowStores.js"),a=require("../../actions/windowActions.js"),o=require("../../actions/webviewActions.js"),n=require("../../stores/projectStores.js"),c=require("../../weapp/utils/projectManager.js"),l=require("../../config/dirConfig.js"),p=require("../../common/request/request.js"),u=require("../../common/log/log.js"),d=require("glob"),h=require("path"),m=require("fs"),f=require("../../config/urlConfig.js"),g=f.cleanUserAuth,v=require("../../config/errcodeConfig.js"),j=v.DEV_PLATFORM_INVALID_EXT_APPID,S=v.DEV_PLATFORM_EXT_APPID_NOT_AUTH,A=t.createClass({displayName:"Cache",getInitialState:function(){return{show:!1}},clickOpen:function(){var e=this.state.show;this.setState({show:!e})},clearStorage:function(){var e=s.getUserInfo(),t=e?e.openid:"unknow",i=l.WeappStorage,a=this.props.project,n=a.appid,c=a.appname,p=h.join(i,n+"_"+c+"_"+t+".data.json");m.unlink(p,function(e){r("清除数据存储成功"),o.upASData(n,{})})},clearFileStorage:function(){var e=s.getUserInfo(),t=e?e.openid:"unknow",i=l.WeappFileCache,a=this.props.project,o=a.hash;d("*",{cwd:i},function(e,s){var a=""+o+t;s.forEach(function(e){if(e.indexOf(a)>-1){var r=h.join(i,e);m.unlink(r)}}),r("清除文件存储成功")})},clearSdkUserAuthStorage:function(){n.setUserAuthPemissionStorage(this.props.project,{}),r("清除授权数据成功")},clearCloudAuth:function(){var t=this.props.project,i=c.getExtAppId(t);p({method:"post",url:g+"?appid="+t.appid+"&ext_appid="+i+"&platform="+(t.platform?1:0),needToken:1},function(t,i,s){var a="清除工具及手机授权数据失败";if(t)u.info("cache.js clearSdkUserAuthStorage error: "+t.toString());else if(s=JSON.parse(s),s.baseresponse){var o=s.baseresponse.errcode;if(0==o)return void r("清除工具及手机授权数据成功");if(o==j)return void r(a+"，无效的 extAppID");if(o==S)return void r(a+"，extAppID 未授权");a=a+"，errcode:"+s.baseresponse.errcode}e(a)})},render:function(){var e=this.state.show?i.displayBlock:i.displayNone;return t.createElement("div",{onClick:this.clickOpen,title:"清除缓存",className:"sidebar-item"},t.createElement("i",{className:"sidebar-item-icon sidebar-item-icon-cache"}),t.createElement("label",{className:"sidebar-item-label"},"缓存"),t.createElement("div",{className:"cache-card",style:e},t.createElement("div",{className:"cache-card-item",onClick:this.clearStorage},t.createElement("p",null,"清除数据存储")),t.createElement("div",{className:"cache-card-item",onClick:this.clearFileStorage},t.createElement("p",null,"清除文件存储")),t.createElement("div",{className:"cache-card-item",onClick:this.clearCloudAuth},t.createElement("p",null,"清除授权数据"))))}});_exports=A}var _exports;init(),module.exports=_exports;