"use strict";function init(){function e(e){n.showTipsMsg({msg:e,type:"error"})}var t=require("glob"),a=(require("path"),require("../../lib/react.js")),r=(require("../../utils/tools.js"),require("../../cssStr/cssStr.js")),i=require("../../utils/newReport.js"),s=require("../../config/urlConfig.js"),o=require("../../common/request/request.js"),c=(require("../../stores/webviewStores.js"),require("../../common/log/log.js")),n=require("../../actions/windowActions.js"),p=(require("../../stores/projectStores.js"),require("../../actions/projectActions.js")),l=require("../../weapp/utils/vendorManager.js"),m="touristappid",d=require("../../config/errcodeConfig.js"),u=d.DEV_Invalid_Appid,h=d.DEV_App_Not_Band,f=a.createClass({displayName:"Createstep",getInitialState:function(){return{projectpath:"",appid:"",appname:"",error:"",saveBtnDisable:!0,showQuickStart:!1,checked:!0,showLoading:!1,isTourist:!1}},chooseDir:function(){var e=this,a=document.createElement("input");a.setAttribute("type","file"),a.setAttribute("nwdirectory",!0),a.style.display="none",global.contentDocumentBody.appendChild(a),a.addEventListener("change",function(r){t("*",{cwd:a.value},function(t,r){var i=0===r.length;e.setState({projectpath:a.value,showQuickStart:i})}),global.contentDocumentBody.removeChild(a)}),a.addEventListener("cancel",function(e){global.contentDocumentBody.removeChild(a)}),a.click()},editAppid:function(e){var t=e.target,a=t.value;this.setState({appid:a})},editAppname:function(e){var t=e.target,a=t.value;this.setState({appname:a})},tourist:function(){this.setState({isTourist:!this.state.isTourist})},addProject:function(){var t=this,a=this.state.projectpath,r=this.state.isTourist,n=r?m:this.state.appid,d=encodeURIComponent(this.state.appname),f=l.getCurrentVendorVersion();if(!n)return void e("请填写 appid ");if(!d)return void e("请填写 项目名称 ");if(!a)return void e("请选择 项目目录 ");var v=n+"_"+d,b=this.props.projectLists.find(function(e){return e.projectid===v});if(b)return void this.setState({appname:"",saveBtnDisable:!0,error:"已存在 "+n+" "+decodeURIComponent(b.appname)+" 项目，请重新输入"});var g=this.state.showQuickStart&&this.state.checked;this.setState({showLoading:!0});var j={projectpath:"",appid:"",appname:"",error:"",saveBtnDisable:!0,showLoading:!1,isTourist:!1};if(r){var k={appid:n,appname:d,projectpath:a,projectid:v,app_head_img:"",is_admin:!1,isTourist:!0,urlCheck:!1,libVersion:f};p.add(k,g),i("project_createsuc",n),this.setState(j),this.props.goMain(k),o({url:s.touristCreateURL+"?appid="+n,needToken:1},function(){})}else o({url:s.createWeappURL+"?appid="+n,needToken:1},function(r,s,o){if(r)c.error("createstep.js create  "+r.toString()),t.setState({showLoading:!1}),e(r.toString());else{t.setState({showLoading:!1}),c.info("createstep.js create  "+o);var l=JSON.parse(o),m=l.baseresponse,k=m?parseInt(m.errcode):0;if(k===h)return e("当前开发者未绑定此 AppID ，请到小程序管理后台操作后重试"),nw.Shell.openExternal("https://mp.weixin.qq.com/"),void c.error("createstep.js create project error "+k);if(k===u)return e("不存在此 AppID 请检查后重新输入或使用无 AppID 模式"),void c.error("createstep.js create project error "+k);if(0===k){var E=l.app_head_img?l.app_head_img+"/0":"",N=d;return l.app_nickname&&(N=encodeURIComponent(l.app_nickname)),b={is_admin:l.is_admin,isTourist:!1,urlCheck:!0,platform:!!l.is_platform,platform_nickname:l.platform_nickname||"",appid:n,appname:d,projectpath:a,projectid:v,app_head_img:E,app_nickname:N,libVersion:f},p.add(b,g),i("project_createsuc",n),t.setState(j),void t.props.goMain(b)}var _=o||"系统错误";e(_)}})},changeCheckbox:function(e){var t=e.target.checked;this.setState({checked:t})},render:function(){var e=this.props.show?{}:r.displayNone,t=this.state.showQuickStart?{}:r.visibilityHidden,i=this.props.createBack,s=this.state.isTourist,o=s?"无 AppID 部分功能受限":this.state.appid,c=s?"":"填写小程序AppID ",n=s?"返回填写小程序AppID":"无 AppID ",p=this.state.showLoading?"create-form-button-primary detail-upload-dialog-button-primary-loading":"create-form-button-primary";return a.createElement("div",{className:"create-step2",style:e},a.createElement("div",{className:"create-toolbar app-drag"},a.createElement("a",{onClick:i,href:"javascript:;",className:"create-toolbar-close app-no-drag"},a.createElement("i",{className:"create-toolbar-back-icon"}),a.createElement("span",null,"返回"))),a.createElement("div",{className:"create-body"},a.createElement("div",{className:"create-name"},"添加项目"),a.createElement("div",{className:"create-form"},a.createElement("div",{className:"create-form-item"},a.createElement("label",{htmlFor:"",className:"create-form-label"},"AppID"),a.createElement("div",{className:"create-form-input-box"},a.createElement("input",{value:o,onChange:this.editAppid,type:"text",className:"create-form-input",disabled:s}),a.createElement("p",{style:this.state.error?r.displayNone:{},className:"create-form-tips"},c,a.createElement("a",{onClick:this.tourist,href:"javascript:;",className:"create-form-tourist"},n)),a.createElement("p",{style:this.state.error?{}:r.displayNone,className:"create-form-tips-warn"},this.state.error))),a.createElement("div",{className:"create-form-item"},a.createElement("label",{htmlFor:"",className:"create-form-label"},"项目名称"),a.createElement("div",{className:"create-form-input-box"},a.createElement("input",{value:this.state.appname,onChange:this.editAppname,type:"text",className:"create-form-input"}))),a.createElement("div",{className:"create-form-item"},a.createElement("label",{htmlFor:"",className:"create-form-label"},"项目目录"),a.createElement("div",{onClick:this.chooseDir,className:"create-form-input-box"},a.createElement("input",{value:this.state.projectpath,disabled:"true",type:"text",className:"create-form-input create-form-input-with-pointer"}),a.createElement("p",{className:"create-form-tips"})),a.createElement("div",{className:"create-form-extra"},a.createElement("a",{href:"javascript:;",onClick:this.chooseDir,className:"create-form-extra-button"},"选择"))),a.createElement("div",{style:t,className:"create-quick-checkbox"},a.createElement("input",{id:"quick-checkbox",onChange:this.changeCheckbox,checked:this.state.checked,type:"checkbox"}),a.createElement("label",{htmlFor:"quick-checkbox"},"在当前目录中创建 quick start 项目"))),a.createElement("div",{className:"create-form-footer"},a.createElement("a",{href:"javascript:;",className:"create-form-button-default",onClick:i},"取消"),a.createElement("a",{onClick:this.addProject,href:"javascript:;",className:p},"添加项目"))))}});_exports=f}var _exports;init(),module.exports=_exports;