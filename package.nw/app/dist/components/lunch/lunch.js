"use strict";function init(){var e=require("../../lib/react.js"),n=require("../../common/request/request.js"),t=(require("../../cssStr/cssStr.js"),require("../../actions/windowActions.js")),r=require("../../common/log/log.js"),i=require("../../config/urlConfig.js"),o="darwin"===process.platform?"darwin":"win",a="https://res.wx.qq.com/zh_CN/htmledition/v2/images/web_wechat_no_contect.png",s=function(e){t.showTipsMsg({msg:e,type:"error"})},c=e.createClass({displayName:"Lunch",handleOnClick:function(){this.props.appQuit()},componentWillUnmount:function(){this.refs.container.innerHTML=""},_loadstop:function(e){var i=this,c=this.webview;c.executeScript({code:"\n            var s = document.createElement('style')\n            s.innerText = `\n              body{\n                overflow:hidden;\n                background-color: #f0f0f0!important;\n                padding: inherit!important;\n                color: #373737!important;\n              }\n              .impowerBox .title {\n                display: none;\n              }\n              .impowerBox .qrcode {\n                width: 170px;\n                height: 170px;\n                margin-top: -7px;\n              }`\n              document.head.appendChild(s)\n              var normal = document.querySelectorAll('.normal')\n              for(var i = 0; i < normal.length; i++) {\n                normal[i].classList.remove('normal')\n              }\n          "}),c.style.display="block";var l=c.request;l.onBeforeRequest.addListener(function(e){if("main_frame"!==e.type)return{};var l=e.url;return l=l.replace("state=login","state="+o),r.info("lunch.js get URL : "+l),n({url:l},function(e,n,o){if(e)s("网络错误 "+e.toString()),c.removeEventListener("loadstop",i._loadstop),i.componentDidMount();else{r.info("lunch.js get res "+JSON.stringify(o)),o=JSON.parse(o);var l=o.baseresponse,d=l.errcode?parseInt(l.errcode):0;if(0!==d)return s("登录失败，错误信息："+l.errmsg),c.removeEventListener("loadstop",i._loadstop),void i.componentDidMount();for(var m in localStorage)0===m.indexOf("projectattr")&&delete localStorage[m];var p=n.headers,u=p["debugger-signature"],h=p["debugger-newticket"],g=+new Date,f={signature:u,newticket:h,openid:o.openid,nickName:o.nickname,headUrl:o.headurl||a,ticketExpiredTime:1e3*o.ticket_expired_time+g,signatureExpiredTime:1e3*o.signature_expired_time+g,sex:1===o.sex?"male":"female",province:o.province,city:o.city,contry:o.contry};t.upDateUserInfo(f)}}),{cancel:!0}},{urls:["<all_urls>"]},["blocking"]),r.info("lunch.js init loginWebview")},componentDidMount:function(){var e=(this.refs.container,this.webview=document.createElement("webview"));e.src=i.LOGIN_URL,e.style.display="none",e.addEventListener("loadstop",this._loadstop),this.refs.container.innerHTML="",this.refs.container.appendChild(e)},showSetting:function(){t.showSetting()},render:function(){var n="win32"===process.platform,t=n?"lunch-toolbar lunch-toolbar-win app-drag":"lunch-toolbar app-drag",r=e.createElement("a",{href:"javascript:;",onClick:this.showSetting,className:"create-toolbar-setting app-no-drag"},"代理",e.createElement("i",{className:"create-toolbar-setting-icon"}));return e.createElement("div",{className:"lunch"},e.createElement("div",{className:t},n?r:"",e.createElement("a",{onClick:this.handleOnClick,href:"javascript:;",className:"lunch-toolbar-close app-no-drag"},e.createElement("i",{className:"{{closeClass}}"})),n?"":r),e.createElement("div",{className:"lunch-body"},e.createElement("div",{className:"lunch-logo-wrapper"},e.createElement("i",{className:"lunch-logo"})),e.createElement("div",{className:"lunch-name"},"微信开发者工具"),e.createElement("div",{className:"lunch-line"}),e.createElement("div",{ref:"container",className:"lunch-qrcode"})))}});_exposts=c}var _exposts;init(),module.exports=_exposts;