"use strict";function init(){var e,t=require("path"),o=require("../lib/react.js"),s=(require("./popup/popup.js"),require("./menubar/menubar.js")),r=require("./toolbar/toolbar.js"),i=require("./sidebar/sidebar.js"),p=require("./develop/develop.js"),n=require("./detail/detail.js"),a=(require("./setting/setting.js"),require("./edit/edit.js")),c=require("../weapp/utils/projectManager.js").manager,m=require("../actions/projectActions.js"),h=require("./about/about.js"),u=require("../stores/windowStores.js"),l=require("../actions/windowActions.js"),d=(require("../stores/webviewStores.js"),require("../actions/webviewActions.js"),require("../weapp/utils/tools.js")),j=require("../common/menu/menu.js"),w=o.createClass({displayName:"Main",getInitialState:function(){var e=this.props.project?u.getLastShow():"debug",t=0,o=0;return{show:e,memory:t,cpu:o}},optProject:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){};u.setLastShow(e),this.setState({show:e},t)},_fileWatcher:function(o,s,r,i){var p=this;if(this.props.project){var n=u.getEditorConfig("autoRefresh");n&&(e&&clearTimeout(e),e=setTimeout(function(){var o=t.extname(r);d.whiteFileExtName[o]&&m.restart(p.props.project),e=void 0},500))}},_openProjectFile:function(){this.optProject("edit")},_memory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;this._memoryTime++;for(var o in e){var s=e[o];s.privateMemory&&(t+=s.privateMemory)}t=parseInt(t/1024/1024),this._memorySum+=t,this._memoryNow=t,this._memoryPre=parseInt(this._memorySum/this._memoryTime)},_cpu:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,o=0;this._cpuTime++;for(var s in e){var r=e[s];r.cpu&&(t+=r.cpu)}this._cpuSUm+=t,t=t.toFixed(2),o=(this._cpuSUm/this._cpuTime).toFixed(2),this._systemCpuSPAN.innerText="内存占用 "+this._memoryNow+"/"+this._memoryPre+" mb, CPU "+t+"/"+o+"%"},componentDidMount:function(e){if(c.on("FILE_CHANGE",this._fileWatcher),this._memoryTime=0,this._memorySum=0,this._cpuTime=0,this._cpuSUm=0,u.initEditorConfig(),global.appConfig.isDev){var t=this._systemCpuSPAN=document.createElement("span");t.style.cssText="position:absolute;top: 10px;right: 10%;margin-bottom: 10px;",global.contentDocumentBody.appendChild(t),chrome.processes.onUpdatedWithMemory.addListener(this._memory),chrome.processes.onUpdated.addListener(this._cpu)}},componentWillUnmount:function(){c.removeListener("FILE_CHANGE",this._fileWatcher),global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.removeListener(this._memory),chrome.processes.onUpdated.removeListener(this._cpu),this._systemCpuSPAN&&this._systemCpuSPAN.remove())},showSetting:function(){l.showSetting()},setMacMenu:function(){"darwin"===process.platform&&(this.props.project&&"edit"===this.state.show?global.nwWindow.menu=j.menuWithEdit:global.nwWindow.menu=j.menu)},render:function(){var e="",t="";return this.setMacMenu(),this.props.project&&(e=o.createElement(a,{show:this.state.show,project:this.props.project,optProject:this.optProject}),t=o.createElement(n,{project:this.props.project,optProject:this.optProject,show:this.state.show})),o.createElement("div",{className:"main"},o.createElement(s,{lastWinStatus:this.props.lastWinStatus,appQuit:this.props.appQuit,appMin:this.props.appMin,appMax:this.props.appMax,showSetting:this.showSetting,project:this.props.project,show:this.state.show}),o.createElement(r,{project:this.props.project}),o.createElement("div",{className:"body"},o.createElement(i,{show:this.state.show,project:this.props.project,optProject:this.optProject}),o.createElement(p,{show:this.state.show,optDebugger:this.optDebugger,project:this.props.project}),e,t),o.createElement(h,null))}});_exports=w}var _exports;init(),module.exports=_exports;