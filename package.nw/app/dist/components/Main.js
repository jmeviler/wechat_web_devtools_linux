"use strict";function init(){var e,t=require("path"),r=require("../lib/react.js"),o=(require("./popup/popup.js"),require("./menubar/menubar.js")),s=require("./toolbar/toolbar.js"),i=require("./sidebar/sidebar.js"),p=require("./develop/develop.js"),n=require("./detail/detail.js"),a=(require("./setting/setting.js"),require("./edit/edit.js")),c=require("../weapp/utils/projectManager.js").manager,m=require("../actions/projectActions.js"),h=require("./about/about.js"),u=require("../stores/windowStores.js"),l=require("../actions/windowActions.js"),j=(require("../stores/webviewStores.js"),require("../actions/webviewActions.js"),require("../weapp/utils/tools.js")),_=r.createClass({displayName:"Main",getInitialState:function(){var e=this.props.project?u.getLastShow():"debug",t=0,r=0;return{show:e,memory:t,cpu:r}},optProject:function(e){u.setLastShow(e),this.setState({show:e})},_projectWatcher:function(r,o,s,i){var p=this;if(this.props.project){var n=r.watcher;n&&(e&&clearTimeout(e),e=setTimeout(function(){var r=t.extname(s);j.whiteFileExtName[r]&&m.restart(p.props.project),e=void 0},500))}},_openProjectFile:function(){this.optProject("edit")},_memory:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0;this._memoryTime++;for(var r in e){var o=e[r];o.privateMemory&&(t+=o.privateMemory)}t=parseInt(t/1024/1024),this._memorySum+=t,this._memoryNow=t,this._memoryPre=parseInt(this._memorySum/this._memoryTime)},_cpu:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=0,r=0;this._cpuTime++;for(var o in e){var s=e[o];s.cpu&&(t+=s.cpu)}this._cpuSUm+=t,t=t.toFixed(2),r=(this._cpuSUm/this._cpuTime).toFixed(2),this._systemCpuSPAN.innerText="内存占用 "+this._memoryNow+"/"+this._memoryPre+" mb, CPU "+t+"/"+r+"%"},componentDidMount:function(e){if(c.on("FILE_CHANGE",this._projectWatcher),u.on("OPEN_PROJECT_FILE",this._openProjectFile),this._memoryTime=0,this._memorySum=0,this._cpuTime=0,this._cpuSUm=0,global.appConfig.isDev){var t=this._systemCpuSPAN=document.createElement("span");t.style.cssText="position:absolute;top: 10px;left: 286px;margin-bottom: 10px;",global.contentDocumentBody.appendChild(t),chrome.processes.onUpdatedWithMemory.addListener(this._memory),chrome.processes.onUpdated.addListener(this._cpu)}},componentWillUnmount:function(){c.removeListener("FILE_CHANGE",this._projectWatcher),u.removeListener("OPEN_PROJECT_FILE",this._openProjectFile),global.appConfig.isDev&&(chrome.processes.onUpdatedWithMemory.removeListener(this._memory),chrome.processes.onUpdated.removeListener(this._cpu),this._systemCpuSPAN&&this._systemCpuSPAN.remove())},showSetting:function(){l.showSetting()},render:function(){var e="",t="";return this.props.project&&(e=r.createElement(a,{show:this.state.show,project:this.props.project}),t=r.createElement(n,{project:this.props.project,optProject:this.optProject,show:this.state.show})),r.createElement("div",{className:"main"},r.createElement(o,{lastWinStatus:this.props.lastWinStatus,appQuit:this.props.appQuit,appMin:this.props.appMin,appMax:this.props.appMax,showSetting:this.showSetting,project:this.props.project}),r.createElement(s,{project:this.props.project}),r.createElement("div",{className:"body"},r.createElement(i,{show:this.state.show,project:this.props.project,optProject:this.optProject}),r.createElement(p,{show:this.state.show,optDebugger:this.optDebugger,project:this.props.project}),e,t),r.createElement(h,null))}});_exports=_}var _exports;init(),module.exports=_exports;