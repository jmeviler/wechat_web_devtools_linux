"use strict";function init(){var t,e=require("../../lib/react.js"),a=(require("../../cssStr/cssStr.js"),require("../../actions/webviewActions.js")),o=require("../../stores/windowStores.js"),s=require("../../actions/windowActions.js"),n=require("./urlcomplete.js"),i=e.createClass({displayName:"Urlbar",getInitialState:function(){return{webviewID:0,url:"",autoIndex:0,autocomplete:[]}},loadUrl:function(t){t=t||this.getCurrentUrl(),t=t.trim();var e=this.state.webviewID;"about:blank"===t?a.setWebviewAction(e,{act:"reLoad"}):(s.setAutoComplete(t),a.getA8keyWebview(e,{url:t,isSync:!0,from:"urlbar"})),this.setState({autocomplete:[]})},getAutoComplete:function(t){var e=t.trim(),a=/^http:\/\//.test(e),s=/^https:\/\//.test(e),n=a||s,i=[],r=o.getAutoComplete();return r.forEach(function(t){e.length>4&&(n?/^https?:\/\//.test(t)||(t=a?"http://"+t:"https://"+t):t=t.replace(/^https?:\/\//,"")),0===t.indexOf(e)&&i.indexOf(t)===-1&&i.push(t)}),i},handleKeyUp:function(t){var e=t.target,a=t.keyCode;this.state.webviewID;if(13===a)e.selectionStart=e.value.length,this.loadUrl();else if(40===a||38===a){var o=this.state.autoIndex,s=this.getCurrentUrl(),n=38===a;if(n)o--,o=o<=0?0:o;else{var i=this.state.autocomplete.length;o++,o=o>=i?i-1:o}s=o>=0?this.state.autocomplete[o]:s,this.setState({autoIndex:o,url:s},function(){setTimeout(function(){e.selectionStart=e.value.length},17)})}else 8===a&&(e.dataset.changeFrom="backspace")},handleChange:function(t){var e=this,a=t.target,o=a.value,s="backspace"===a.dataset.changeFrom,n=this.getAutoComplete(o);this.state.webviewID;if(s)return a.dataset.changeFrom="",void this.setState({url:o,autocomplete:n});var i=n[0]&&!s?n[0]:o;this.setState({url:i,autocomplete:n},function(){var t=i.indexOf(o)+o.length;t!==i.length&&(e.refs.urlinput.selectionStart=t,e.refs.urlinput.selectionEnd=i.length)})},handleBlur:function(){var e=this;t=setTimeout(function(){e.setState({autocomplete:[]})},100)},handleFocus:function(){var t=this.getCurrentUrl(),e=this.getAutoComplete(t);this.setState({autocomplete:e})},handleOnClick:function(){this.loadUrl()},getCurrentUrl:function(){return this.state.url},autoClick:function(e){clearTimeout(t);var a=e.currentTarget,o=a.dataset,s=o.index,n=this.state.autocomplete[s];this.setState({url:n,autocomplete:[]}),this.loadUrl(n)},_changeWebviewID:function(t){this.setState({webviewID:t})},_changeUrl:function(t){0===t.indexOf("chrome-extension:")&&(t="about:blank"),this.setState({url:t})},_focusAddressbar:function(t){this.refs.urlinput.select(),this.refs.urlinput.focus()},componentDidMount:function(){o.on("CHANGE_WEBVIEW_URL",this._changeUrl),o.on("FOCUS_ADDRESSBAR",this._focusAddressbar)},componentWillUnmount:function(){o.removeListener("CHANGE_WEBVIEW_URL",this._changeUrl),o.removeListener("FOCUS_ADDRESSBAR",this._focusAddressbar)},render:function(){var t=(this.state.webviewID,this.state.url);return e.createElement("div",{className:"toolbar-location"},e.createElement("input",{className:"toolbar-location-input",type:"text",ref:"urlinput",onKeyDown:this.handleKeyUp,onBlur:this.handleBlur,onFocus:this.handleFocus,value:t,onChange:this.handleChange}),e.createElement("div",{className:"toolbar-location-refresh"},e.createElement("i",{className:"toolbar-location-refresh-icon"})),e.createElement("div",{className:"toolbar-location-history"},e.createElement("i",{className:"toolbar-location-history-icon"})),e.createElement(n,{autoClick:this.autoClick,autocomplete:this.state.autocomplete,autoIndex:this.state.autoIndex}))}});_exports=i}var _exports;init(),module.exports=_exports;