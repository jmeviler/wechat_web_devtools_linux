"use strict";function init(){var e=require("../../lib/react.js"),t=require("../../cssStr/cssStr.js"),a=(require("../../actions/projectActions.js"),require("../../stores/projectStores.js"),require("../../weapp/utils/projectManager.js")),s=require("../../stores/windowStores.js"),r=require("../../actions/windowActions.js"),i=require("../../config/sceneConfig.js"),c=i.getSceneWording,n=i.sceneData,o="custompreview",l=e.createClass({displayName:"CustomPreview",getInitialState:function(){return{lazyLoaded:!1,err:"",referDataErr:"",page:"",query:"",show:!1,type:"",enable:!1,showSceneList:!1,showLaunch:!1,beta:global.appConfig.isBeta}},checkPage:function(e){var t=this.state.project;return!this.state.page||(a.isProjectPage(t,this.state.page)?(this.setState({err:""}),!0):(this.setState({err:"页面不存在，请检查后重试"}),!1))},checkReferData:function(){if(!this.state.enable||!this.state.showLaunch)return!0;try{JSON.parse(this.state.referData||"{}")}catch(e){return this.setState({showLaunch:!0,referDataErr:"解析错误，"+e}),!1}return!0},changeQuery:function(e){var t=e.target.value;this.setState({query:t})},changePage:function(e){var t=e.target.value;this.setState({page:t})},upload:function(e){if(this.checkPage()&&this.checkReferData()){var t=this.state;this.state.callback({page:t.page||"",query:t.query,scene:t.scene,enable:t.enable,referData:t.showLaunch?t.referData:"",appid:t.showLaunch?t.appid:""}),this.close()}},_showCustomPreview:function(e){var t=e.project,a=t.uploadPath,s=t.initPath,r="upload"===e.type?a:s,i=r.page,n=r.query,o=r.enable,l=r.scene,m=r.appid,p=r.referData;this.setState({lazyLoaded:!0,show:!0,page:i||"",query:n||"",project:t,scene:l||"",sceneWording:c(l),referData:p||"",appid:m||"",callback:e.callback,type:e.type,showLaunch:"mini_program"===l,enable:o})},changeEnable:function(){this.setState({enable:!this.state.enable})},changeAppId:function(e){var t=e.target.value;this.setState({appid:t})},changeReferData:function(e){var t=e.target.value,a="";try{JSON.parse(t)}catch(e){a="解析错误，"+e}this.setState({referData:t,referDataErr:a})},onSceneSelect:function(e){e.stopPropagation();var t=e.currentTarget.dataset,a=t.scene,s=t.wording,i={showSceneList:!1,scene:a,sceneWording:s};"mini_program"===a?i.showLaunch=!0:i.showLaunch=!1,r.clickToolsbar(o),this.setState(i)},onShowSceneList:function(e){e.stopPropagation(),this.setState({showSceneList:!0})},close:function(){this.setState({err:"",page:"",query:"",show:!1,type:"",enable:!1})},_clickToolsbar:function(e){o!=e&&this.setState({showSceneList:!1})},componentDidMount:function(){s.on("SHOW_CUSTOM_PREVIEW",this._showCustomPreview),s.on("BODY_CLICK",this._clickToolsbar),s.on("CLICK_TOOLSBAR",this._clickToolsbar)},componentWillUnmount:function(){s.removeListener("SHOW_CUSTOM_PREVIEW",this._showCustomPreview),s.removeListener("BODY_CLICK",this._clickToolsbar),s.removeListener("CLICK_TOOLSBAR",this._clickToolsbar)},render:function(){if(!this.state.lazyLoaded)return null;var a=this.state.show?t.displayBlock:t.displayNone,s="upload"===this.state.type,r=s?"预览":"确定",i=s?"预览":"编译",c=this.state.showLaunch&&!s?t.displayBlock:t.displayNone,o=[];for(var l in n)o.push(e.createElement("div",{className:"custom-preview-dropdown-item","data-scene":l,"data-wording":n[l],onClick:this.onSceneSelect},l+": "+n[l]));return e.createElement("div",{className:"setting-show",style:a},e.createElement("div",{className:"setting-hd"},e.createElement("h3",{className:"setting-hd-title"},"自定义",i)),e.createElement("div",{className:"setting-bd"},e.createElement("div",{className:"custom-preview"},e.createElement("div",{className:"custom-preview-form"},e.createElement("div",{className:"custom-preview-form-item"},e.createElement("div",{className:"custom-preview-form-label"},"设置启动页面"),e.createElement("div",{className:"custom-preview-form-value"},e.createElement("input",{type:"text",onChange:this.changePage,value:this.state.page,placeholder:"页面地址（默认为首页）"})),e.createElement("div",{className:"custom-preview-form-tips"},e.createElement("p",null,this.state.err))),e.createElement("div",{className:"custom-preview-form-item"},e.createElement("div",{className:"custom-preview-form-label"},"设置页面自定义参数"),e.createElement("div",{className:"custom-preview-form-value"},e.createElement("input",{value:this.state.query,onChange:this.changeQuery,type:"text",placeholder:"参数"}))),e.createElement("div",{className:"custom-preview-form-item",style:s||this.state.beta?t.displayNone:{}},e.createElement("div",{className:"custom-preview-form-label"},"设置应用进入的场景"),e.createElement("div",{className:"custom-preview-form-value"},e.createElement("div",{className:"custom-preview-form-input-wrapper",onClick:this.onShowSceneList},e.createElement("input",{value:this.state.scene+": "+this.state.sceneWording,disabled:!0,type:"text"}),e.createElement("i",{className:this.state.showSceneList?"custom-preview-dropdown-icon-up":"custom-preview-dropdown-icon-down"})),e.createElement("div",{className:"custom-preview-dropdown",style:this.state.showSceneList?{}:t.displayNone},o))),e.createElement("div",{style:c},e.createElement("div",{className:"custom-preview-form-item"},e.createElement("div",{className:"custom-preview-form-label"},"设置启动的 appid ",e.createElement("span",null,"*必填")),e.createElement("div",{className:"custom-preview-form-value"},e.createElement("input",{type:"text",onChange:this.changeAppId,value:this.state.appid,placeholder:"启动的 appid"}))),e.createElement("div",{className:"custom-preview-form-item",style:s?t.displayNone:{}},e.createElement("div",{className:"custom-preview-form-label"},"设置启动的数据 (JSON)"),e.createElement("div",{className:"custom-preview-form-value"},e.createElement("textarea",{value:this.state.referData,onChange:this.changeReferData,type:"text",placeholder:""})),e.createElement("div",{className:"custom-preview-form-tips"},e.createElement("p",null,this.state.referDataErr)))),e.createElement("div",{style:s?t.displayNone:{},className:"custom-preview-form-item"},e.createElement("div",{className:"custom-preview-form-value"},e.createElement("label",{onClick:this.changeEnable,htmlFor:"customPreviewCheckbox",className:"custom-preview-form-checkbox"},e.createElement("input",{checked:this.state.enable,type:"checkbox"}),e.createElement("i",null),"保存为默认编译模式")))))),e.createElement("div",{className:"setting-ft"},e.createElement("a",{onClick:this.close,href:"javascript:;",className:"setting-button-default"},"取消"),e.createElement("a",{onClick:this.upload,href:"javascript:;",className:"detail-meta-upload"},r)))}});_exports=l}var _exports;init(),module.exports=_exports;