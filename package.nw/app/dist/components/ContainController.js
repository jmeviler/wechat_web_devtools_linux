"use strict";function init(){var t=require("../lib/react.js"),e=require("../actions/windowActions.js"),i=require("../stores/windowStores.js"),s=require("../stores/webviewStores.js"),o=require("../stores/projectStores.js"),n=(require("../actions/projectActions.js"),require("../common/log/log.js")),r=require("./setting/setting.js"),a=require("./lunch/lunch.js"),c=require("./create/create.js"),u=require("./confirm/confirm.js"),h=require("./toast/toast.js"),l=require("./Main.js"),m=require("../utils/newReport.js"),p=require("../config/config.js"),g=p.SELECT_URL_TYPE,v=p.SELECT_UNKNOW_TYPE,_=function(t){e.showTipsMsg({msg:t,type:"error"})},f=global.Win,L=void 0,S=void 0,j=void 0,d=void 0,T={editor:1,proxy:2,notify:3},w=t.createClass({displayName:"ContainController",getInitialState:function(){var t=!!Object.keys(i.getUserInfo()).length,s=o.getLastSelect(),n=s===g,r="",a=!1;if(s!==g&&s!==v){r=s;var c=i.getEditorConfig("autoRefresh");void 0===c&&e.updateEditorConfig({autoRefresh:r.watcher})}var u=i.getLastWinStatus()||{};return{hasLogin:t,commonUrl:n,project:r,type:s,showSetting:a,lastWinStatus:u,cursorLoading:!1}},componentDidMount:function(){this.state.hasLogin&&(this.state.project||this.state.commonUrl)&&this.appToMax(),i.on("UPDATA_USER_INFO",this._upDataUserInfo),s.on("NOT_LOGIN",this.goToLogin),s.on("INVALID_LOGIN",this.goToLogin),o.on("CLOSE_PROJECT",this._closeProject),o.on("DEL_PROJECT",this._delProject),i.on("SHOW_SETTING",this._showSetting),f.on("maximize",this._maximize),f.on("restore",this._restore),f.on("enter-fullscreen",this._enterFullscreen),f.on("resize",this._resize),f.on("move",this._move)},componentWillUnmount:function(){i.removeListener("UPDATA_USER_INFO",this._upDataUserInfo),s.removeListener("NOT_LOGIN",this.goToLogin),s.removeListener("INVALID_LOGIN",this.goToLogin),o.removeListener("CLOSE_PROJECT",this._closeProject),o.removeListener("DEL_PROJECT",this._delProject),i.removeListener("SHOW_SETTING",this._showSetting),f.removeListener("maximize",this._maximize),f.removeListener("restore",this._restore),f.removeListener("enter-fullscreen",this._enterFullscreen),f.removeListener("resize",this._resize),f.removeListener("move",this._move)},setLastWinStatus:function(t){this.setState({lastWinStatus:t}),(this.state.commonUrl||this.state.project)&&i.setLastWinStatus(t)},restore:function(t){var e=this,s=f.isFullscreen;clearTimeout(j),clearTimeout(d);var o=function o(){if(f.removeListener("move",e._move),f.removeListener("resize",e._resize),f.removeListener("restore",e._restore),"init"===t)f.resizeTo(nw.App.manifest.window.width,nw.App.manifest.window.height),setTimeout(function(){f.setPosition("center"),setTimeout(function(){f.on("resize",e._resize),f.on("move",e._move),f.on("restore",e._restore)},300)},500);else{var n=i.getLastWinStatus();n.isFullscreen=!1,n.status="restore";var r=void 0===n.x?100:n.x,a=void 0===n.y?100:n.y;r=r<-300?0:r,a=a<-300?0:a,f.moveTo(r,a);var c=void 0===n.width?nw.App.manifest.window.width:n.width,u=void 0===n.height?nw.App.manifest.window.height:n.height;f.resizeTo(c,u),e.setLastWinStatus(n),setTimeout(function(){f.on("resize",e._resize),f.on("move",e._move),f.on("restore",e._restore)},300)}s&&f.removeListener("restore",o)};s?(f.on("restore",o),f.leaveFullscreen()):o()},_move:function(){var t=this;clearTimeout(d),d=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.x=f.x,e.y=f.y,t.setLastWinStatus(e)},500)},_resize:function(){var t=this;clearTimeout(j),j=setTimeout(function(){var e=Object.assign({},t.state.lastWinStatus);e.width=f.width,e.height=f.height,t.setLastWinStatus(e)},500)},_enterFullscreen:function(){var t=Object.assign({},this.state.lastWinStatus);t.isFullscreen=!0,this.setLastWinStatus(t)},_maximize:function(){clearTimeout(j),clearTimeout(d);var t=Object.assign({},this.state.lastWinStatus);t.status="max",L=f.height,S=f.width,this.setLastWinStatus(t)},_restore:function(){var t=Object.assign({},this.state.lastWinStatus);t.status="restore",t.isFullscreen=!1,f.width===S&&f.height===L&&(t.status="max"),this.setLastWinStatus(t)},_upDataUserInfo:function(t){var e=this,i=!!Object.keys(t).length;i?(this.setState({hasLogin:!0}),(this.state.project||this.state.commonUrl)&&this.appToMax()):setTimeout(function(){e.goToLogin()},50)},_delProject:function(){this.setState({project:"",commonUrl:""}),this.restore("init")},_closeProject:function(){s.setCurrentWebviewID(0),this.setState({project:"",commonUrl:""}),this.restore("init")},_setCursorLoading:function(t){this.setState({cursorLoading:t})},goToLogin:function(){this.setState({hasLogin:!1,commonUrl:"",project:""}),this.restore("init")},handleOnClick:function(t){e.bodyClick(t)},appQuit:function(){n.info("ContainController.js exit"),nw.App.quit()},appToMax:function(){var t=this.state.lastWinStatus,e=t.status;t.isFullscreen?f.enterFullscreen():"max"===e||void 0===e?f.maximize():this.restore()},appMax:function(){var t=this.state.lastWinStatus,e=t.status;"max"!==e?f.maximize():this.restore()},appMin:function(){global.Win.minimize()},goMain:function(t){var e=this;t?o.setProjectConfig(t,function(i){return i?void _(i):(e.setState({commonUrl:!1,project:t,type:t}),o.setProjectType(t.hash),void e.appToMax())}):(this.setState({commonUrl:!0,project:"",type:g}),o.setProjectType(g),this.appToMax());t?m("project_open",t.appid):m("url_open")},_showSetting:function(){this.setState({showSetting:!this.state.showSetting})},render:function(){var e=void 0,i=!this.state.commonUrl&&!this.state.project,s={};return s[T.proxy]=!0,s[T.editor]=!i&&!!this.state.project,s[T.notify]=!i,e=this.state.hasLogin?i?t.createElement(c,{appQuit:this.appQuit,goMain:this.goMain,type:this.state.type}):t.createElement(l,{lastWinStatus:this.state.lastWinStatus,project:this.state.project,appQuit:this.appQuit,appMax:this.appMax,appMin:this.appMin}):t.createElement(a,{appQuit:this.appQuit}),t.createElement("div",{onClick:this.handleOnClick,style:this.state.cursorLoading?{cursor:"wait !important"}:{}},e,t.createElement(r,{show:this.state.showSetting,toggleShow:this._showSetting,project:this.state.project,enables:s,category:T,inSelectProject:i,setCursorLoading:this._setCursorLoading}),t.createElement(h,null),t.createElement(u,null))}});_exports=w}var _exports;init(),module.exports=_exports;