"use strict";function init(){var e=require("url"),n=require("os"),o=require("path"),t=require("fs"),i=require("http"),r=require("../common/log/log.js"),s=require("child_process"),a=s.exec,c=(s.execSync,require("rmdir"),require("../config/dirConfig.js")),p=(nw.App,{}),l=!1,u=9973,f="darwin"===process.platform,g="last-version";_exports={parseURL:function(e){var n=/^http(s)?:\/\//;return n.test(e)?e:"http://"+e},getAvailablePort:function(e){function n(e){var o=u,t=i.createServer(function(){});t.on("error",function(t){r.info("tools.js getAvailablePort error "+o),u++,n(e)}),t.listen(o,"127.0.0.1",function(n){t.once("close",function(){u=o+1,e(o)}),t.close()})}n(function(n){r.info("tools.js getAvailablePort success "+n),e(n)})},getAppConfig:function(){var e=nw.App.getDataPath(),n=o.join(e,"..","config.json"),i={isDev:!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app"),isBeta:nw.App.manifest.beta===!0},s=t.existsSync(n);if(!s)return i;try{i=JSON.parse(t.readFileSync(n))}catch(e){}return r.info("tools.js getAppConfig: "+JSON.stringify(i)),i.isDev=i.isDev||!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app"),i.onLine=!1,i},getArgsURL:function(e){var n=Array.isArray(e);n||(e=e.split(" "));var o=e.find(function(e){return 0===e.indexOf("href://")});if(o){var t=o.replace("href://","");return this.parseURL(t)}},getSysIpInfo:function(){var e=n.networkInterfaces(),o=[];return Object.keys(e).forEach(function(n){var t=0;e[n].forEach(function(e){"IPv4"===e.family&&e.internal===!1&&(t>=1||o.push(e.address))})}),r.info("index.js getSysIpInfo: "+JSON.stringify(o)),o},openInspectWin:function(e){var n=require("path");nw.Window.open("about:blank",{show:!1,width:799,height:799,inject_js_end:n.join(__dirname,"../inject/chromeInspect.js")},function(e){e.maximize(),e.window.location="chrome://inspect/#devices",e.show(),r.info("index.js openInspectWin")})},clearProxyCache:function(){p={}},getProxyForURL:function(n){var o=e.parse(n);return n=o.protocol+"//"+o.hostname,p[n]?r.info("tools.js getProxyForURL "+n+" from proxyCache: "+p[n]):(p[n]=nw.App.getProxyForURL(n),r.info("tools.js getProxyForURL "+n+" from nw.App.getProxyForURL: "+p[n])),p[n]},getVersionNum:function(e){return e=e||nw.App.manifest.version,e=e.replace(/\./g,""),parseInt(e)},showNewVersionLog:function(){var e=this.getVersionNum(),n=localStorage[g]||0;if(e>n){var o=require("../config/urlConfig.js");nw.Shell.openExternal(o.NEW_VERSION_LOG),localStorage.setItem(g,e)}},notifications:function(e,n,o,t){var i=(+new Date).toString();return t=t||function(){},o=o||[],l||(l={},chrome.notifications.onButtonClicked.addListener(function(e,n){l[e]&&l[e](n)})),l[i]=t,chrome.notifications.create(i,{type:"basic",iconUrl:"app/images/logo.png",title:e,message:n,buttons:o}),i},up:function e(n){var t=this,i=global.appVersion=nw.App.manifest.version;if(this.showNewVersionLog(),global.appConfig.isDev)return void n();var s=localStorage.getItem("new-version"),p=this.getVersionNum(s),l=this.getVersionNum();if(l<p){r.info("tools.js currentVersion: "+i+" newVersion: "+s+" ");var u=c.WeappApplication,g=f?o.join(u,s,"app.nw"):o.join(u,s,"package.nw"),v=global.contentDocument.querySelector("#container");v.innerHTML='<div class="app-up-data">更新中...</div>';var e=function(e,o,i){e?(v.innerHTML='<div class="app-up-data">更新失败</div>',setTimeout(function(){n()},3e3)):(v.innerHTML="",global.appVersion=s,v.innerHTML='<div class="app-up-data">更新成功，当前版本 '+s+"</div>",global.contentWindow.title="微信web开发者工具 v"+s,global.Win.title="微信web开发者工具 v"+s,setTimeout(function(){n(),t.showNewVersionLog()},1e3),delete localStorage["new-version"]),delete localStorage["new-version"]};if(f){var h=o.join(__dirname,"../../../../");a('cp -r "'+g+'" "'+h+'"',e)}else{var w=require("node-windows"),d='xcopy "'+g+'" "'+o.join(process.execPath,"..","package.nw")+'" /s /e /y /i';console.debug(d),w.elevate(d,e)}}else n()}}}var _exports;init(),module.exports=_exports;