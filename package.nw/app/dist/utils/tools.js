"use strict";function init(){var e=require("url"),n=(require("os"),require("path")),o=(require("fs"),require("http")),i=require("../common/log/log.js"),r=require("child_process"),t=r.exec,a=(r.execSync,require("rmdir"),require("../config/dirConfig.js")),s=(nw.App,{}),c=!1,p=9973,l="darwin"===process.platform,u="last-version";_exports={parseURL:function(e){var n=/^http(s)?:\/\//;return n.test(e)?e:"http://"+e},getAvailablePort:function(e){function n(e){var r=p,t=o.createServer(function(){});t.on("error",function(o){i.info("tools.js getAvailablePort error "+r),p++,n(e)}),t.listen(r,"127.0.0.1",function(n){t.once("close",function(){p=r+1,e(r)}),t.close()})}n(function(n){i.info("tools.js getAvailablePort success "+n),e(n)})},getAppConfig:function(){var e={isDev:!!process.execPath.match("nw.exe")||!!process.execPath.match("nwjs.app"),isBeta:nw.App.manifest.beta===!0,isGamma:nw.App.manifest.gamma===!0};return e},getArgsURL:function(e){var n=Array.isArray(e);n||(e=e.split(" "));var o=e.find(function(e){return 0===e.indexOf("href://")});if(o){var i=o.replace("href://","");return this.parseURL(i)}},openInspectWin:function(e){var n=require("path");nw.Window.open("about:blank",{show:!1,width:799,height:799,inject_js_end:n.join(__dirname,"../inject/chromeInspect.js")},function(e){e.maximize(),e.window.location="chrome://inspect/#devices",e.show(),i.info("index.js openInspectWin")})},clearProxyCache:function(){s={}},getProxyForURL:function(n){var o=e.parse(n);return n=o.protocol+"//"+o.hostname,s[n]?i.info("tools.js getProxyForURL "+n+" from proxyCache: "+s[n]):(s[n]=nw.App.getProxyForURL(n),i.info("tools.js getProxyForURL "+n+" from nw.App.getProxyForURL: "+s[n])),s[n]},getVersionNum:function(e){return e=e||nw.App.manifest.version,e=e.replace(/\./g,""),parseInt(e)},showNewVersionLog:function(){var e=this.getVersionNum(),n=localStorage[u]||0;if(e>n){var o=require("../config/urlConfig.js");nw.Shell.openExternal(o.NEW_VERSION_LOG),localStorage.setItem(u,e)}},notifications:function(e,n,o,i){var r=(+new Date).toString();return i=i||function(){},o=o||[],c||(c={},chrome.notifications.onButtonClicked.addListener(function(e,n){c[e]&&c[e](n)})),c[r]=i,chrome.notifications.create(r,{type:"basic",iconUrl:"app/images/logo.png",title:e,message:n,buttons:o}),r},up:function e(o){var r=this,s=global.appVersion=nw.App.manifest.version;if(this.showNewVersionLog(),global.appConfig.isDev)return void o();var c=localStorage.getItem("new-version"),p=this.getVersionNum(c),u=this.getVersionNum();if(u<p){i.info("tools.js currentVersion: "+s+" newVersion: "+c+" ");var f=a.WeappApplication,g=l?n.join(f,c,"app.nw"):n.join(f,c,"package.nw"),v=global.contentDocument.querySelector("#container");v.innerHTML='<div class="app-up-data">更新中...</div>';var e=function(e,n,i){e?(v.innerHTML='<div class="app-up-data">更新失败</div>',setTimeout(function(){o()},3e3)):(v.innerHTML="",global.appVersion=c,v.innerHTML='<div class="app-up-data">更新成功，当前版本 '+c+"</div>",global.contentWindow.title="微信web开发者工具 v"+c,global.Win.title="微信web开发者工具 v"+c,setTimeout(function(){o(),r.showNewVersionLog()},1e3),delete localStorage["new-version"]),delete localStorage["new-version"]};if(l){var m=n.join(__dirname,"../../../../");t('cp -r "'+g+'" "'+m+'"',e)}else{var w=require("node-windows"),h='xcopy "'+g+'" "'+n.join(process.execPath,"..","package.nw")+'" /s /e /y /i';console.debug(h),w.elevate(h,e)}}else o()}}}var _exports;init(),module.exports=_exports;