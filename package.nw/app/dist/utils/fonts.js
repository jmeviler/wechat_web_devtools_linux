"use strict";function init(){var r=void 0;return function(t){function n(){var r=JSON.parse(localStorage.getItem("fontDirMTime")),t=[];if("osx"===u){var n=process.env.HOME;t=[l.join(n,"Library","Fonts"),l.join("/","Library","Fonts"),l.join("/","System","Library","Fonts")]}else if("windows"===u){var e=process.env.windir||process.env.WINDIR;t=[l.join(e,"Fonts")]}var i=!0,o=!1,s=void 0;try{for(var f,v=t[Symbol.iterator]();!(i=(f=v.next()).done);i=!0){var y=f.value,m=void 0;try{m=a.statSync(y)}catch(r){return c.error(r),!0}if(r[y]!==m.mtime.getTime())return!0}}catch(r){o=!0,s=r}finally{try{!i&&v.return&&v.return()}finally{if(o)throw s}}return!1}function e(){var r=[];if("osx"===u){var t=process.env.HOME;r=[l.join(t,"Library","Fonts"),l.join("/","Library","Fonts"),l.join("/","System","Library","Fonts")]}else if("windows"===u){var n=process.env.windir||process.env.WINDIR;r=[l.join(n,"Fonts")]}var e=[],o={},s=!0,c=!1,f=void 0;try{for(var v,y=r[Symbol.iterator]();!(s=(v=y.next()).done);s=!0){var m=v.value,d=void 0;try{d=a.statSync(m),o[m]=d.mtime.getTime()}catch(r){return[]}e=e.concat(i(m,d))}}catch(r){c=!0,f=r}finally{try{!s&&y.return&&y.return()}finally{if(c)throw f}}return localStorage.setItem("fontDirMTime",JSON.stringify(o)),e}function i(r){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!t)try{t=a.statSync(r)}catch(r){return[]}if(t.isDirectory()){var n=void 0;try{n=a.readdirSync(r)}catch(r){c.error(r)}return n.reduce(function(t,n){return t.concat(i(l.join(r,n)))},[])}var e=l.extname(r).toLowerCase();switch(e){case".ttf":case".otf":case".ttc":case".woff":case".woff2":case".dfont":return[r];default:return[]}}function o(r){var t={},n=[],e=!0,i=!1,o=void 0;try{for(var a,l=r[Symbol.iterator]();!(e=(a=l.next()).done);e=!0){var s=a.value;t[s]||(n.push(s),t[s]=!0)}}catch(r){i=!0,o=r}finally{try{!e&&l.return&&l.return()}finally{if(i)throw o}}return n}if(r)return void t(null,r);var a=require("fs"),l=require("path"),s=require("async"),c=require("../common/log/log.js"),u="darwin"===process.platform?"osx":"windows";if(r=JSON.parse(localStorage.getItem("fontList")||null),r&&!n())return void t(null,r);var f=require("fontkit"),v=e(),y=[],m=!0,d=!1,h=void 0;try{for(var S,w=function(){var r=S.value;y.push(function(t){f.open(r,function(r,n){try{if(r)reject(r);else if(n.familyName){var e=n.familyName.toString();e.match(/^[a-zA-Z]/)?t(null,e):t(null,null)}else if(n.fonts){var i=n.fonts[0].familyName.toString();i.match(/^[a-zA-Z]/)?t(null,i):t(null,null)}else t(null,null)}catch(r){t(null,null)}})})},p=v[Symbol.iterator]();!(m=(S=p.next()).done);m=!0)w()}catch(r){d=!0,h=r}finally{try{!m&&p.return&&p.return()}finally{if(d)throw h}}s.parallelLimit(y,5,function(n,e){if(n)t(n);else{var i=o(e.filter(function(r){return r})).sort();localStorage.setItem("fontList",JSON.stringify(i)),t(null,i),r=i}})}}module.exports=init();