"use strict";function init(){function e(e){var t=e.headers.host,o=e.connection.encrypted&&!/^http:/.test(e.url)?"https":"http",p="http"===o?e.url:o+"://"+t+e.url,s=r.parse(p);return s.pureHref=s.href.replace(/\?.*/,"").replace(/\#.*/,""),s}var r=(require("fs"),require("url")),t=require("path"),o=(require("zlib"),require("../../utils/report.js"),require("../../weapp/weApp.js")),p=require("../../config/config.js"),s="https://clients1.google.com/tbproxy/af/",i=p.weappURLRegular,n=p.weappASURLRegular,u=p.weappLocalIdRegular;_exports={shouldUseLocalResponse:function(r,t){var o=e(r),p=o.pureHref;return!!i.test(p)||(0===p.indexOf(s)||(!!n.test(p)||!!u.test(p)))},dealLocalResponse:function(r,p,a){var c=e(r),l=c.pureHref;if(i.test(l)){var f=c.href;o.getResponse(f,function(e,r,o){if(e)return void a(e,r,o||"");t.extname(f).replace(".","");a(200,r,o)})}else 0===l.indexOf(s)?(console.error(s),a(400,{},"")):n.test(l)?o.getAppservice(l,function(e,r,t){return e?void a(e,{},t):void a(200,r,t)}):u.test(l)&&o.getLocalIdResponse(l.replace(u,"wxfile://"),function(e,r,t){return e?void a(e,{},t):void a(200,r,t)})}}}var _exports;init(),module.exports=_exports;