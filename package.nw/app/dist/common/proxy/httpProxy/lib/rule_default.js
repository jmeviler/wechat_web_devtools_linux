"use strict";function mergeCORSHeader(e,o){var r=o||{};return delete r["Access-Control-Allow-Credentials"],delete r["Access-Control-Allow-Origin"],delete r["Access-Control-Allow-Methods"],delete r["Access-Control-Allow-Headers"],r["access-control-allow-credentials"]="true",r["access-control-allow-origin"]=e.origin||e.Origin||"-___-||",r["access-control-allow-methods"]="GET, POST, PUT",r["access-control-allow-headers"]=e["access-control-request-headers"]||"-___-||",r}var path=require("path"),fs=require("fs");module.exports={summary:function(){var e="the default rule for AnyProxy which supports CORS.";return e},shouldUseLocalResponse:function(e,o){if("OPTIONS"==e.method)return!0;var r=(e.headers.host||"")+(e.url||"");return mapConfig.map(function(o){var n=o.keyword;if(r.indexOf(n)>=0)return e.anyproxy_map_local=o.local,!1}),!!e.anyproxy_map_local},dealLocalResponse:function(e,o,r){"OPTIONS"==e.method?r(200,mergeCORSHeader(e.headers),""):e.anyproxy_map_local&&fs.readFile(e.anyproxy_map_local,function(e,o){e?r(200,{},"[AnyProxy failed to load local file] "+e):r(200,{},o)})},replaceRequestProtocol:function(e,o){},replaceRequestOption:function(e,o){},replaceRequestData:function(e,o){},replaceResponseStatusCode:function(e,o,r){},replaceResponseHeader:function(e,o,r){return mergeCORSHeader(e.headers,r)},replaceServerResDataAsync:function(e,o,r,n){n(r)},pauseBeforeSendingResponse:function(e,o){},saveAllHttpResponse:function(e,o,r,n){},fetchTrafficData:function(e,o){}};