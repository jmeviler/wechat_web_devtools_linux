"use strict";function init(){function e(){return"edit"===i.getLastShow()}var o=this,n=require("../../actions/webviewActions.js"),t=require("../../stores/webviewStores.js"),i=(require("../../stores/projectStores.js"),require("../../stores/windowStores.js")),r=require("../../actions/windowActions.js"),c=require("../../actions/projectActions.js"),a=require("../../common/request/request.js"),d=(require("../../config/errcodeConfig.js"),require("../log/log.js")),m=require("../../utils/newReport.js"),s=("darwin"===process.platform,require("../../config/urlConfig.js")),u=s.getBbsTicket,p=s.checkApiAuth,l=s.getAuthList,f=s.setAuth,g=!1;i.on("EDITOR_FOCUS",function(){return g=!0}),i.on("EDITOR_BLUR",function(){return g=!1}),_exports={newFile:function(){e()&&r.execEditorCommand({command:"newTempFile"})},save:function(){e()&&r.execEditorCommand({command:"save"})},saveAll:function(){e()&&r.execEditorCommand({command:"saveAll"})},closeFile:function(){e()&&r.execEditorCommand({command:"close"})},closeProject:function(){c.close(),m("project_"+close,o.props.project.appid)},undo:function(){e()&&r.execEditorCommand({command:"undo"})},redo:function(){e()&&r.execEditorCommand({command:"redo"})},copy:function(){e()&&i.isEditorFocus()?r.execEditorCommand({command:"copy"}):global.contentDocument.execCommand("copy")},cut:function(){e()&&i.isEditorFocus()?r.execEditorCommand({command:"cut"}):global.contentDocument.execCommand("cut")},paste:function(){e()&&i.isEditorFocus()?r.execEditorCommand({command:"paste",data:nw.Clipboard.get().get("text")}):global.contentDocument.execCommand("paste")},unindent:function(){e()&&r.execEditorCommand({command:"unindent"})},indent:function(){e()&&r.execEditorCommand({command:"indent"})},format:function(){e()&&r.execEditorCommand({command:"format"})},moveLineUp:function(){e()&&r.execEditorCommand({command:"moveLineUp"})},moveLineDown:function(){e()&&r.execEditorCommand({command:"moveLineDown"})},copyLineUp:function(){e()&&r.execEditorCommand({command:"copyLineUp"})},copyLineDown:function(){e()&&r.execEditorCommand({command:"copyLineDown"})},find:function(){e()&&r.execEditorCommand({command:"find"})},globalFind:function(){e()&&r.execEditorCommand({command:"globalFind"})},replace:function(){e()&&r.execEditorCommand({command:"replace"})},toggleSimulatorView:function(){r.execEditorCommand({command:"toggleSimulatorView"})},toggleFileTreeView:function(){r.execEditorCommand({command:"toggleFileTreeView"})},gotoFile:function(){e()&&r.execEditorCommand({command:"gotoFile"})},gotoRecentFile:function(){e()&&r.execEditorCommand({command:"gotoRecentFile"})},reBuild:function(){var e=t.getCurrentWebviewID();n.setWebviewAction(e,{act:"reBuild"})},showSetting:function(){r.showSetting()},jumpDoc:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/framework/MINA.html")},jumpBbs:function(e){a({url:u,needToken:1},function(o,n,t){if(!o){var i=JSON.parse(t),c=i.open_ticket;c?e?nw.Shell.openExternal(e+"&devcode="+c):nw.Shell.openExternal("https://developers.weixin.qq.com/welogin?devcode="+c):r.showConfirm({content:"登录社区失败 错误信息  "+t,type:"alert",callback:function(){}})}})},showChangeLog:function(){nw.Shell.openExternal("https://mp.weixin.qq.com/debug/wxadoc/dev/devtools/download.html")},showAbout:function(){r.showAbout()},reload:function(){var e=t.getCurrentWebviewID();n.setWebviewAction(e,{act:"reLoad"})},goback:function(){var e=t.getCurrentWebviewID();n.setWebviewAction(e,{act:"goBack"})},goforward:function(){var e=t.getCurrentWebviewID();n.setWebviewAction(e,{act:"goForward"})},focusAddressBar:function(){var e=t.getCurrentWebviewID();r.focusAddressBar(e)},checkApiAuth:function(e,o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},t=e.appid,i=e.ext_appid,r=e.platform;a({url:p+"?appid="+t+"&ext_appid="+i+"&platform="+(r?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid,jsapi:o}),needToken:1},function(e,o,t){var i=void 0;try{i=JSON.parse(t);var r=i.baseresponse,c=r?parseInt(r.errcode):-1e4;if(0===c)n(null,{desc:i.auth_desc,scope:i.scope,state:i.state});else{var a=r?r.errmsg:"unknown error "+c;n(a)}}catch(e){return void n("system error "+e)}})},getAuthList:function(e){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=e.appid,t=e.ext_appid,i=e.platform;a({url:l+"?appid="+n+"&ext_appid="+t+"&platform="+(i?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid}),needToken:1},function(e,n,t){var i=void 0;try{i=JSON.parse(t)}catch(e){return void o("system error "+t)}var r=i.baseresponse,c=r?parseInt(r.errcode):-1e4;0===c?o(null,i.auth_item):(d.error("common/actions/actions.js getAuthList error "+c),o(c))})},setAuth:function(e,o){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){},t=e.appid,i=e.ext_appid,r=e.platform;a({url:f+"?appid="+t+"&ext_appid="+i+"&platform="+(r?1:0)+"&_r="+Math.random(),method:"post",body:JSON.stringify({appid:e.ext_appid?e.ext_appid:e.appid,auth_item:o}),needToken:1},function(e,o,t){var i=void 0;try{i=JSON.parse(t)}catch(e){return void n("system error "+t)}var r=i.baseresponse,c=r?parseInt(r.errcode):-1e4;0===c?n(null):(d.error("common/actions/actions.js setAuth error "+c),n(c))})}}}var _exports;init(),module.exports=_exports;