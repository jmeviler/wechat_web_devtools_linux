"use strict";function init(){function e(e,t){navigator.mediaDevices.getUserMedia(v).then(function(e){a=e,s=[];try{n=new MediaRecorder(a,m)}catch(e){return u.error("voiceSdk.js Exception while creating MediaRecorder: "+e),void t({errMsg:"startRecord:fail "+JSON.stringify(e)})}n.onstop=function(){var e=p.getCurrentProject(),r=new Blob(s,{type:"audio/webm"}),o=new FileReader;o.addEventListener("loadend",function(){var r=l.copyFileDataToTemp(o.result,e.hash,".silk");t({errMsg:"startRecord:ok",tempFilePath:r}),n=void 0}),o.readAsDataURL(r),f.toggleRecordWording(!1)},n.ondataavailable=function(e){e.data&&e.data.size>0&&s.push(e.data)},clearTimeout(c),c=setTimeout(function(){n&&n.stop()},6e4),n.start(10),f.toggleRecordWording(!0)}).catch(function(e){t({errMsg:"startRecord:fail 未找到或者无权限调用录音设备"})})}function t(e,t){clearTimeout(c),n&&n.stop(),t({errMsg:"stopRecord:ok"})}function r(e,t){var r=e.args,o=r.filePath,i=l.getRealPath(o);if(d&&d.dataset.filePath!==o)d.remove();else if(d&&d.dataset.filePath===o)return void d.play();d=document.createElement("audio"),document.body.appendChild(d),g.readFile(i,"utf8",function(e,r){e?t({errMsg:"playVoice:fail read "+o+" error"}):(d.src=r,d.play(),d.dataset.filePath=o,t({errMsg:"playVoice:ok"}))})}function o(e,t){d&&d.pause(),t({errMsg:"pauseVoice:ok"})}function i(e,t){d&&d.remove(),d=void 0,t({errMsg:"pauseVoice:ok"})}var a,s,n,c,d,u=require("../log/log.js"),l=require("../../utils/file.js"),p=require("../../stores/projectStores.js"),f=require("../../actions/webviewActions.js"),g=require("fs"),v={audio:!0},m={mimeType:"audio/webm"};_exports={startRecord:e,stopRecord:t,playVoice:r,pauseVoice:o,stopVoice:i}}var _exports;init(),module.exports=_exports;