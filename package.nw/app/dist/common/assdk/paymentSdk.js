"use strict";function init(){function e(e){s.showTipsMsg({msg:e,type:"error"})}function r(r,a){var s=(JSON.stringify(r.args),r.appid),n=r.ext_appid,p=o.getCurrentProject();t({url:f+"?appid="+s+"&ext_appid="+n+"&platform="+(p.platform?1:0),loginForc:1,needToken:1,method:"post",body:JSON.stringify({payment_args:JSON.stringify(r.args)})},function(r,t,o){if(r)e(JSON.stringify(r)),a({errMsg:"requestPayment:fail"});else{var c=void 0;try{c=JSON.parse(o)}catch(t){return e("系统错误 "+JSON.stringify(t)),log.error("paymentSdk.js parse body error: "+o+" "+JSON.stringify(r)),void a({errMsg:"requestPayment:fail"})}var f=c.baseresponse,l=f?parseInt(f.errcode):-1;if(0===l)m({uuid:c.wxa_pay_uuid,qrcode:c.qrcode_img,platform:p.platform,appid:s,ext_appid:n,callback:a});else if(l===i){var y="当前开发者绑定时间不足 24 小时，请过后重试";e(y),a({errMsg:"requestPayment:fail "+y})}else l===u?(e("无效的 extAppID"),a({errMsg:"requestPayment:fail invalid extAppID"})):l===d?(e("extAppID 未授权"),a({errMsg:"requestPayment:fail extAppID not auth"})):(e("系统错误，错误码 "+l+"，错误信息 "+f.errmsg),a({errMsg:"requestPayment:fail"}))}})}var t=require("../request/request.js"),a=require("../../config/errcodeConfig.js"),i=a.DEV_BIND_NOT_24H,s=require("../../actions/windowActions.js"),n=require("../../actions/webviewActions.js"),o=(require("../../weapp/utils/projectManager.js"),require("../../stores/projectStores.js")),p=require("../../config/errcodeConfig.js"),u=p.DEV_PLATFORM_INVALID_EXT_APPID,d=p.DEV_PLATFORM_EXT_APPID_NOT_AUTH,c=require("../../config/urlConfig.js"),f=c.paymentURL,l=c.paymentStateURL,y=null,g=function(){y&&(clearInterval(y),y=null)},m=function(r){var a=r.uuid,i=r.qrcode,s=r.appid,o=r.ext_appid,p=r.platform,u=r.callback,d=function(e){g(),u&&u(e)};g(),n.operatePaymentQrcodeWnd({callback:function(){d({errMsg:"requestPayment:fail"})},type:"show",uuid:a,qrcode:i}),y=setInterval(function(){t({url:l+"?appid="+s+"&ext_appid="+o+"&platform="+(p?1:0),loginForc:1,needToken:1,method:"post",body:JSON.stringify({wxa_pay_uuid:a})},function(r,t,a){if(r)e({msg:JSON.stringify(r),type:"error"}),d({errMsg:"requestPayment:fail"});else{var i=void 0;try{i=JSON.parse(a)}catch(t){return e("系统错误 "+JSON.stringify(t)),log.error("paymentSdk.js payment parse body error: "+a+" "+JSON.stringify(r)),void d({errMsg:"requestPayment:fail"})}var s=i.baseresponse,o=s?parseInt(s.errcode):-1;if(0===o){var p=parseInt(i.qrcode_state);if(4===p||3===p)return void n.operatePaymentQrcodeWnd({type:"update",qrcodeState:p});if(5===p){var u=JSON.parse(i.payment_ret);return u.errMsg=u.err_msg.replace(/^get_brand_wcpay_request/,"requestPayment"),delete u.err_msg,d(u),void n.operatePaymentQrcodeWnd({type:"close"})}e(1===p?"UUID 错误":2===p?"等待超时，请重试":"系统错误 错误码 "+p),d({errMsg:"requestPayment:fail"})}else e("系统错误，错误码 "+o+"，错误信息 "+s.errmsg)}})},3e3)};_exports={requestPayment:r}}var _exports;init(),module.exports=_exports;