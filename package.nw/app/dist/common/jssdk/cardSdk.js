"use strict";function init(){var r=require("../log/log.js"),e=require("../../config/urlConfig.js"),a=(require("../../config/errcodeConfig.js"),e.batchGetCardInfoURL),i=e.chooseCardURL,d=e.batchViewCardURL,s=function(e,s,t,o){var n=require("../request/request.js"),c=s.sdkName,_=s.args,p=_.appId;if("batchAddCard"===c){for(var f=_.card_list||[],l={},g=[],u=0,S=f.length;u<S;u++){var h=f[u];l[h.card_id]?l[h.card_id]++:(g.push(h),l[h.card_id]=1)}var b={appid:p,getitem_list:g},j={url:a,body:JSON.stringify(b),method:"post",needToken:1};r.info("cardSdk.js batchAddCard begin "+JSON.stringify(j)),n(j,function(e,a,i){if(e)r.error("cardSdk.js batchAddCard error "+JSON.stringify(e)),o(e);else{r.info("cardSdk.js batchAddCard get "+i);var d=JSON.parse(i),s=d.baseresponse,t=s.errcode;if(0===t){var n=d.json_ret_list.map(function(r){return r=JSON.parse(r),r.amount=l[r.card_tp_id],r});o(null,n)}else o(s,[])}})}else if("chooseCard"===c){var y={appid:p,shop_id:_.location_id||0,sign_type:_.sign_type,card_sign:_.card_sign,time_stamp:_.time_stamp,nonce_str:_.nonce_str,card_tp_id:_.card_id,card_type:_.card_type},C={url:i,body:JSON.stringify(y),method:"post",needToken:1};r.info("cardSdk.js chooseCard begin "+JSON.stringify(C)),n(C,function(e,a,i){if(e)r.error("cardSdk.js chooseCard error "+JSON.stringify(e)),o(e);else{r.info("cardSdk.js chooseCard get "+i);var d=JSON.parse(i),s=d.baseresponse;0===s.errcode?o(null,JSON.parse(d.json_ret)):o(s,[])}})}else if("batchViewCard"===c){_.card_list=_.card_list||[];var N=_.card_list.map(function(r){return{card_tp_id:r.card_id,code:r.code}}),J={appid:p,items:N},O={url:d,body:JSON.stringify(J),method:"post",needToken:1};r.info("cardSdk.js batchViewCard begin "+JSON.stringify(O)),n(O,function(e,a,i){if(e)r.error("cardSdk.js batchViewCard error "+JSON.stringify(e)),o(e);else{r.info("cardSdk.js batchViewCard get "+i);var d=JSON.parse(i),s=d.baseresponse;if(0===s.errcode){var t=d.json_ret?JSON.parse(d.json_ret):{card_array:[]},n=d.error_json_ret_list.map(function(r){return JSON.parse(r)}),c={retData:t,errData:n};o(null,c)}else o(s,[])}})}};_exports={exec:s}}var _exports;init(),module.exports=_exports;